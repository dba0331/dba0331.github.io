"use strict";(self.webpackChunkjitdba_site=self.webpackChunkjitdba_site||[]).push([[6586],{5119:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var s=t(4848),i=t(8453);const r={},o=void 0,a={id:"4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e",title:"insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e",description:"insert\u8bed\u53e5\u63d2\u5165\u4e86 895557\u6761, \u8868\u4e0a\u6709\u81ea\u589e\u5217",source:"@site/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e.md",sourceDirName:"4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb",slug:"/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tidbSidebar",previous:{title:"insert\u81ea\u52a8\u63d0\u4ea4",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/insert\u81ea\u52a8\u63d0\u4ea4"},next:{title:"update\u663e\u5f0f\u4e8b\u52a1",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/update\u663e\u5f0f\u4e8b\u52a1"}},l={},c=[{value:"\u7528\u65f6\u4e3b\u5e72\u90e8\u5206",id:"\u7528\u65f6\u4e3b\u5e72\u90e8\u5206",level:2},{value:"\u5404\u90e8\u5206",id:"\u5404\u90e8\u5206",level:2},{value:"\u53e6\u4e00\u4e2a\u4f8b\u5b50",id:"\u53e6\u4e00\u4e2a\u4f8b\u5b50",level:2}];function _(n){const e={br:"br",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components},{Details:r}=e;return r||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.p,{children:["insert\u8bed\u53e5\u63d2\u5165\u4e86 895557\u6761, \u8868\u4e0a\u6709\u81ea\u589e\u5217",(0,s.jsx)(e.br,{}),"\n","insert into T select ... from S where ..."]}),"\n",(0,s.jsxs)(e.p,{children:["\u6267\u884c\u8ba1\u5212",(0,s.jsx)(e.br,{}),"\n",(0,s.jsx)(e.img,{alt:"insert\u6848\u4f8b",src:t(2154).A+"",width:"1200",height:"316"})]}),"\n",(0,s.jsx)(e.p,{children:"T\u8868\u7279\u6027:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u975e\u5206\u533a, \u975e\u805a\u7c07, \u4e3b\u952ebigint auto_increment"}),"\n",(0,s.jsx)(e.li,{children:"60\u4e2a\u5b57\u6bb5, \u4e00\u4e2a\u666e\u901a\u7d22\u5f15,"}),"\n",(0,s.jsx)(e.li,{children:"\u5e73\u5747\u884c\u957f500\u5b57\u8282, \u767d\u5929\u770b\u4e00\u822c\u51e0\u5341\u4e07\u884c, 200M\u5927\u5c0f"}),"\n",(0,s.jsx)(e.li,{children:"50\u591a\u4e2aregion(\u542b\u7d22\u5f15), \u6b63\u5e38200M\u5e94\u8be5\u5c31\u51e0\u4e2aregion"}),"\n",(0,s.jsx)(e.li,{children:"\u53ef\u80fd\u662f\u8dd1\u6279\u65f6\u8868\u81a8\u80c0\u5f97\u6bd4\u8f83\u5927, \u6709\u51e0\u767e\u4e07\u6761, \u6240\u4ee5region\u591a\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u7528\u65f6\u4e3b\u5e72\u90e8\u5206",children:"\u7528\u65f6\u4e3b\u5e72\u90e8\u5206"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"time: 6m15.1s\nprepare: 4m47.6s,\n  auto_id_allocator: 112ms\n    scan_detail: {num_rpc:108, keys:108}\n    commit_txn\n      count:27, region_num:27, write_keys:27\n      prewrite:294ms, \n      commit:85ms\ninsert:1m27.5s,\ncommit_txn:\n  prewrite:29.2s,\n  commit:709.8ms,\n  slowest_prewrite_rpc: 0.505s\n  commit_primary_rpc: 19ms\n  region num:27, write_keys:2686671\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4ece\u7528\u65f6\u770b, \u597d\u8c61 time = prepare + insert",(0,s.jsx)(e.br,{}),"\n","commit\u7528\u4e8630s, \u4e0d\u77e5\u9053\u7b97\u5728\u54ea\u91cc"]}),"\n",(0,s.jsxs)(e.p,{children:["\u63d2\u4e00\u884c\u8bb0\u5f55, \u8bb0\u5f55\u7684KV\u6570 = (\u8868 + \u4e00\u4e2a\u4e3b\u952e + \u4e00\u4e2a\u7d22\u5f15) = 3",(0,s.jsx)(e.br,{}),"\n","\u603bKV\u6570\u91cf = 895557 * 3 = 2686671"]}),"\n",(0,s.jsx)(e.h2,{id:"\u5404\u90e8\u5206",children:"\u5404\u90e8\u5206"}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:"prepare\u90e8\u5206"}),(0,s.jsx)("div",{children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"prepare: \n    total: 4m47.6s,\n    auto_id_allocator: {\n        alloc_cnt:27,\n        Get: {num_rpc:108, total_time:159.8ms}, \n        total_process_time: 29ms, \n        total_wait_time: 34ms, \n        tikv_wall_time: 112.9ms, \n        scan_detail: {\n            total_process_keys: 108,\n            total_process_keys_size: 812560, \n            total_keys: 108\n            get_snapshot_time: 42.9ms, \n            rocksdb: {\n                block: {\n                    cache_hit_count: 1448, \n                    read count: 5,\n                    read byte: 193.9 KB, \n                    read time: 149.8\u03bcs\n                }\n            }\n        },\n        commit_txn: {\n            count: 27,\n            prewrite:294.1ms,\n            get_commit_ts:26.3ms, \n            commit:85ms,\n            slowest_prewrite_rpc: {\n                total: 0.134s,\n                region_id: 10518380,\n                store: 10.10.10.73:20162, \n                tikv_wall_time: 133ms, \n                scan_detail: {\n                    get_snapshot_time: 24.9\u03bcs, \n                    rocksdb: {\n                        block: {cache_hit_count: 15}\n                    }\n                },\n                write_detail: {\n                    store_batch_wait: 28.5\u03bcs, \n                    propose_send wait: 0s, \n                    persist_log: {\n                        total: 203.2\u03bcS\n                        write_leader_wait: 240ns, \n                        sync_log: 126.9\u03bcs,\n                        write_memtable: 10.1\u03bcs\n                    },\n                    Commit_log: 517.1us,\n                    apply_batch_wait: 31.9us,\n                    apply: {\n                        total:131.8ms,\n                        mutex_lock: 0s,\n                        write_leader_wait: 131.5ms, \n                        write wal: 31.9\u03bcs,\n                        write_memtable: 140.4\u03bcs\n                    }\n                }\n            },\n            commit_primary_rpc: {\n                total: 0.034s,\n                region id: 10518380, \n                store: 10.10.10.73:20162, \n                tikv_wall_time: 33.3ms, \n                scan_detail: {\n                    get_snapshot_time: 11.3ms, \n                    rocksdb: {block: {}}\n                }, \n                write detail: {\n                    store batch wait: 13.8\u03bcs, \n                    propose_send_wait: 0s,\n                    persist_log: {\n                        total: 250.3\u03bcs, \n                        write_leader_wait: 220ns, \n                        sync_log: 175.3us, \n                        write_memtable: 4.74\u03bcs\n                    }, \n                    commit log: 676.1us, \n                    apply batch_wait: 29.7us,\n                    apply: {\n                        total:156.2\u03bcs, \n                        mutex_lock: 0s, \n                        write_leader_wait: 0s, \n                        write_wal: 29.7us, \n                        write_memtable: 35\u03bcs\n                    }\n                }\n            },\n            region_num:27, write_keys:27, write_byte:1416\n        }\n    }\n},\n"})})})]}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:"insert\u548ccommit\u90e8\u5206"}),(0,s.jsx)("div",{children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"insert:1m27.5s,\ncommit_txn: {\n    prewrite:29.2s,\n    get_commit_ts:1.27ms,\n    commit:709.8ms,\n    slowest_prewrite_rpc: {\n        total: 0.505s, region_id:31851992, store: 10.10.10.73:20163, tikv_wall_time: 459.2ms,\n        scan_detail: {get_snapshot_time: 17.8us, rocksdb: {block: {cache_hit_count: 12}}},\n        write_detail: {\n            store_batch_wait: 24.9ms, \n            propose_send_wait: 0s,\n            persist_log: {\n                total: 5.86ms, \n                write_leader_wait: 260ns, \n                sync_log: 1.68ms,\n                write_memtable: 8\u03bcs\n            },\n            commit_log: 17.7ms, \n            apply_batch_wait: 59.3ms,\n            apply: {\n                total:284.4ms, \n                mutex_lock: os, \n                write_leader_wait: 0s, \n                write_wal: 59.3ms, \n                write_memtable: 887.8us\n            }\n        }\n    },\n    commit_primary_rpc: {\n        total: 0.019s, \n        region_id: 37817083, \n        store: 10.10.10.73:20163, \n        tikv_wall_time: 18.7ms,\n        scan_detail: {\n            get_snapshot_time: 27.5us, \n            rocksdb: {\n                block: \n                {\n                    cache_hit_count: 1770,\n                    read_count: 3, \n                    read byte: 47.9 KB, \n                    read time: 64.8\u03bcs\n                }\n            }\n        },\n        write detail: {\n            store_batch_wait: 173.1us, \n            propose_send_wait: 0s,\n            persist_log: {\n                total:2.42ms, \n                write_leader_wait:320ns, \n                sync_log:2.2ms,\n                write memtable: 5.3\u03bcs\n            },\n            commit_log: 3.45ms, \n            apply_batch_wait: 23.8us,\n            apply: {\n                total:4.4ms, \n                mutex_lock: 0s, \n                write_leader_wait: 0s, \n                write_wal: 23.8us,\n                write_memtable: 2.28ms\n            }\n        }\n    },\n    region_num:27, write_keys:2686671, write_byte:826814562\n}\n"})})})]}),"\n",(0,s.jsx)(e.h2,{id:"\u53e6\u4e00\u4e2a\u4f8b\u5b50",children:"\u53e6\u4e00\u4e2a\u4f8b\u5b50"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"insert\u6848\u4f8b",src:t(9280).A+"",width:"1200",height:"415"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"insert\u6848\u4f8b",src:t(4239).A+"",width:"1200",height:"913"})})]})}function m(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(_,{...n})}):_(n)}},2154:(n,e,t)=>{t.d(e,{A:()=>s});const s=t.p+"assets/images/insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e-16d45f81beff45603310b844abd73e33.jpg"},9280:(n,e,t)=>{t.d(e,{A:()=>s});const s=t.p+"assets/images/insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e2-1-ea94012860f64a4b39855be1b554e6d2.jpg"},4239:(n,e,t)=>{t.d(e,{A:()=>s});const s=t.p+"assets/images/insert\u81ea\u52a8\u63d0\u4ea4_\u5e26\u81ea\u589e2-2-75dfb6ea05e5a5f614883df973d92822.jpg"},8453:(n,e,t)=>{t.d(e,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);