"use strict";(self.webpackChunkjitdba_site=self.webpackChunkjitdba_site||[]).push([[2499],{1700:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var t=s(4848),i=s(8453);const r={sidebar_position:5},l="",c={id:"4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/DML\u7684\u7528\u65f6",title:"DML\u7684\u7528\u65f6",description:"update\u4f8b1",source:"@site/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/DML\u7684\u7528\u65f6.md",sourceDirName:"4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb",slug:"/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/DML\u7684\u7528\u65f6",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/DML\u7684\u7528\u65f6",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tidbSidebar",previous:{title:"\u7d22\u5f15\u56de\u8868",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/\u7d22\u5f15\u56de\u8868"},next:{title:"insert\u60b2\u89c2\u624b\u52a8\u63d0\u4ea4",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/1\u6267\u884c\u8ba1\u5212/2plan\u53cainfo\u89e3\u8bfb/insert\u60b2\u89c2\u624b\u52a8\u63d0\u4ea4"}},d={},a=[{value:"update\u4f8b1",id:"update\u4f8b1",level:2},{value:"insert\u4f8b2",id:"insert\u4f8b2",level:2},{value:"delete\u4f8b3",id:"delete\u4f8b3",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function o(e){const n={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:""}),"\n",(0,t.jsx)(n.h2,{id:"update\u4f8b1",children:"update\u4f8b1"}),"\n",(0,t.jsx)(n.p,{children:"update\u8bed\u53e5, \u4fee\u6539\u4e86283079\u884c, \u4e50\u89c2\u4e8b\u52a1, \u81ea\u52a8\u63d0\u4ea4"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"dml\u6848\u4f8b1",src:s(4773).A+"",width:"1200",height:"337"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u7c7b\u4f3c\u8bed\u53e5\nupdate T\nset t.col1 = replace(substr(t.col1, 1, char_length(t.coln)),...),\n    t.col2 = replace(substr(...))\n    ...\nwhere\n    t.batch_id = 'xxx'\n"})}),"\n",(0,t.jsx)(n.p,{children:"update\u4ece\u5f00\u59cb\u5230\u7ed3\u675f, \u6162\u65e5\u5fd7\u663e\u793a\u7528\u4e8632.5s\u3002"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u90a3\u4e48\u63a8\u7b97 update\u4e2d\u663e\u793a\u7684time 23s, \u4ec5\u662fprepare\u6570\u636e\u90e8\u5206;"}),"\n",(0,t.jsx)(n.li,{children:"commit\u7528\u65f69s\u591a, \u4e3b\u8981\u662fkv\u591a, \u5982\u679ckv\u5c11\u5219\u7528\u65f6\u5c11\u4e8e1\u79d2;"}),"\n",(0,t.jsx)(n.li,{children:"\u5168\u90e8\u7528\u65f6 32s = 23s + 9s;"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u5168\u8868\u626b\u63cf\u7528\u4e86399ms, \u5230\u63d0\u4ea4\u4e4b\u524d, \u4e00\u5171\u7528\u4e8623s, \u53bb\u4e86\u54ea\u91cc?"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u672c\u4f8b\u4e2dsql\u8bed\u53e5\u6bd4\u8f83\u590d\u6742, set\u4e2d\u6709\u5f88\u591a\u51fd\u6570\u8fd0\u7b97\u3002"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5176\u5b83\u590d\u6742\u7684\u8fd0\u7b97\u5982 (where t1.col1 ",(0,t.jsx)(n.code,{children:"regexp"})," t2.col2)\u8fd9\u7c7b, \u8fd0\u7b97\u5341\u4e07\u6b21, \u4f30\u8ba1\u4e5f\u8981\u82b1\u5341\u51e0\u79d2\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u53e6\u4e00\u4e2aupdate\u4e50\u89c2\u81ea\u52a8\u63d0\u4ea4, \u603b\u65f6\u957f44s, \u4e3b\u8981\u662f\u6162\u5728 slowest rpc 7.9s\u3002",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.img,{alt:"dml\u6848\u4f8b1",src:s(6381).A+"",width:"1200",height:"227"})]}),"\n",(0,t.jsx)(n.h2,{id:"insert\u4f8b2",children:"insert\u4f8b2"}),"\n",(0,t.jsxs)(n.p,{children:["\u60b2\u89c2insert, \u4e0a\u9501,\n",(0,t.jsx)(n.img,{alt:"dml\u6848\u4f8b2",src:s(6594).A+"",width:"1200",height:"361"})]}),"\n",(0,t.jsx)(n.h2,{id:"delete\u4f8b3",children:"delete\u4f8b3"}),"\n",(0,t.jsxs)(n.p,{children:["delete from t; -- \u5168\u8868\u5220\u9664, \u60b2\u89c2\u4e8b\u52a1, \u4e0a\u9501",(0,t.jsx)(n.br,{}),"\n","sql\u8017\u8d39\u7684\u81ea\u7136\u65f6\u95f4\u662f43s\u3002 \u6709\u4e0d\u5c11mvcc\u5386\u53f2\u7248\u672c\u7684\u6570\u636e, skip\u4e86418\u4e07\u3002",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.img,{alt:"dml\u6848\u4f8b3",src:s(1488).A+"",width:"1200",height:"368"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,t.jsx)(n.p,{children:"DML\u8bed\u53e5\u4ece\u6267\u884c\u5230\u63d0\u4ea4\u5b8c\u6210\u7684\u7528\u65f6, \u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u90e8\u5206:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"sql\u67e5\u8be2\u6570\u636e"}),"\n",(0,t.jsx)(n.li,{children:"sql\u52a0\u5de5\u6570\u636e (\u6709\u65e0\u590d\u6742\u8ba1\u7b97)"}),"\n",(0,t.jsx)(n.li,{children:"\u60b2\u89c2\u4e8b\u52a1\u7684\u4e0a\u9501\u7528\u65f6 (kv\u591a\u4e0d\u591a)"}),"\n",(0,t.jsx)(n.li,{children:"\u4e50\u89c2\u4e8b\u52a1\u5728prewrite\u9636\u6bb5\u7684\u7528\u65f6 (kv\u591a\u4e0d\u591a)"}),"\n",(0,t.jsxs)(n.li,{children:["\u5199\u5230tikv (\u6bd4\u5982\u63d2\u5165\u8bed\u53e5\u7684",(0,t.jsx)(n.code,{children:"{insert:41.9s}"}),"?)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u67e5\u8be2\u6570\u636e + \u52a0\u5de5\u6570\u636e + \u5199\u5230tikv, \u5728insert\u4e2d\u7edf\u79f0\u4e3aprepare\u9636\u6bb5\u7528\u65f6, \u5728update\u4e2d\u6ca1\u8bf4, \u4f30\u8ba1\u4e5f\u5dee\u4e0d\u591a\u3002"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"insert\u7684prepare\u9636\u6bb5, \u4e0d\u662fJDBC API\u91cc\u7684PrepareStmt()\u7684prepare\u6982\u5ff5\u3002"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},4773:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/DML\u7684\u7528\u65f61-6b3a786231cbffc8397834256b11a2e8.jpg"},6381:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/DML\u7684\u7528\u65f62-c485da8e90930b50c8f3b212480c4e34.jpg"},1488:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/DML\u7684\u7528\u65f63-1667e0031fd047921c990dbc3953c0e5.jpg"},6594:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/insert\u60b2\u89c2\u624b\u52a8\u63d0\u4ea4-01107a091d4ec25750a038fa4239a4e9.jpg"},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var t=s(6540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);