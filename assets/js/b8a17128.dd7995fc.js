"use strict";(self.webpackChunkjitdba_site=self.webpackChunkjitdba_site||[]).push([[3081],{3656:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>s,metadata:()=>d,toc:()=>l});var i=t(4848),o=t(8453),r=t(6113);const s={sidebar_position:7,title:"\u5206\u6790\u6848\u4f8b\u95ee\u9898"},c="",d={id:"4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501/7\u5206\u6790\u6848\u4f8b\u95ee\u9898",title:"\u5206\u6790\u6848\u4f8b\u95ee\u9898",description:"\u793a\u610f\u56fe",source:"@site/docs/4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501/7\u5206\u6790\u6848\u4f8b\u95ee\u9898.md",sourceDirName:"4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501",slug:"/4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501/7\u5206\u6790\u6848\u4f8b\u95ee\u9898",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501/7\u5206\u6790\u6848\u4f8b\u95ee\u9898",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7,title:"\u5206\u6790\u6848\u4f8b\u95ee\u9898"},sidebar:"tidbSidebar",previous:{title:"\u9501\u7684\u6e05\u7406",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501/6\u9501\u7684\u6e05\u7406"},next:{title:"\u5206\u6790TxnLockNotFound",permalink:"/docs/4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501/8\u5206\u6790TxnLockNotFound"}},a={},l=[{value:"\u68c0\u7d22(\u5206\u6790\u6848\u4f8b\u95ee\u9898)",id:"\u68c0\u7d22\u5206\u6790\u6848\u4f8b\u95ee\u9898",level:2}];function p(n){const e={h1:"h1",h2:"h2",p:"p",...(0,o.R)(),...n.components},{Details:t}=e;return t||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"\u793a\u610f\u56fe"}),"\n","\n",(0,i.jsx)(r.A,{children:"/img/4SQL\u4e0e\u4f18\u5316/3\u4e8b\u52a1\u548c\u9501/\u5206\u6790\u6848\u4f8b\u95ee\u9898.svg"}),"\n",(0,i.jsx)(e.h1,{id:""}),"\n",(0,i.jsx)(e.h2,{id:"\u68c0\u7d22\u5206\u6790\u6848\u4f8b\u95ee\u9898",children:"\u68c0\u7d22(\u5206\u6790\u6848\u4f8b\u95ee\u9898)"}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"used by local search"}),(0,i.jsx)("div",{children:(0,i.jsx)(e.p,{children:"\u4e00\u6761\u5c0fdml\u7528\u4e86\u51e0\u79d2,\n\u8017\u65f6\u5728prewrite,\u6709backoff,\nautocommit,\u53ef\u80fd\u662f\u4e50\u89c2\n\u6ce8\u610f, \u8fd9\u662f\u9690\u5f0f, \u4e14\u9ed8\u8ba4\u5148\u4ee5\u4e50\u89c2\u4e8b\u52a1\u81ea\u52a8\u63d0\u4ea4\u3002\nsql\u7684\u4fe1\u606f\u8bf4backoff\n\u7c7b\u578b\u662ftxnLock\n\u8868\u660e\u662f\u4e50\u89c2\u4e8b\u52a1\u5728prewrite\u65f6\u7684\u5199\u5199\u51b2\u7a81\u3002\n\u60b2\u89c2\u4e8b\u52a1\u4e0d\u4f1a\u6709prewrite\u5199\u5199\u51b2\u7a81,\u56e0\u4e3aprewrite\u524d\u5c31\u4e0a\u9501\u4e86\u3002\n\u5b98\u7f51\u8bf4,\u5199\u5199\u51b2\u7a81\u7684\n\u91cd\u8bd5\u673a\u5236\u662f\u9ed8\u8ba4\u5173\u95ed\u7684,\n\u6240\u4ee5\u4e0d\u5e94\u8be5\u6709backoff\n\u5b98\u7f51\u662f\u8fd9\u4e48\u8bf4\u7684\n\u663e\u5f0f\u4e50\u89c2\u4e8b\u52a1 \u4e0d\u91cd\u8bd5 tidb_disable_txn_auto_retry;\n\u9690\u5f0f\u4e50\u89c2\u4e8b\u52a1, \u9ed8\u8ba4\u91cd\u8bd510\u6b21 tidb_retry_limit;\n\u672c\u4f8b\u662f\u9690\u5f0f\u4e50\u89c2, \u5199\u5199\u51b2\u7a81(txnLock)\u4f1a\u81ea\u52a8backoff\u91cd\u8bd5;\n\u5b98\u7f51\u8bf4,prewrite\u9636\u6bb5\n\u6709 [\u5199\u5199\u51b2\u7a81\u68c0\u6d4b]\n\u548c [\u9501\u51b2\u7a81\u68c0\u6d4b]\n\u4e2a\u4eba\u8fd9\u4e48\u7406\u89e3\u6587\u6863\n\u201cprewrite\u7b2c\u4e00\u6b65\u68c0\u67e5\u5199\u5199\u51b2\u7a81, \u7b2c\u4e8c\u6b65\u68c0\u67e5key\u662f\u5426\u4e0a\u9501\u201d\u3002\n[\u68c0\u67e5\u5199\u5199\u51b2\u7a81]\u662f\u6307 tikv scheduler latch, \u4e0d\u662f txnLock,\n[\u68c0\u67e5key\u7684\u9501]\u65f6\u51b2\u7a81\u624d\u662f\u771f\u6b63\u7684 txnLock\u3002\n\u6240\u4ee5\u5230\u5e95\u662f\n\u5199\u5199\u51b2\u7a81, \u8fd8\u662f\u9501\u51b2\u7a81\n\u903b\u8f91\u4e71\u4e86,\n\u4ed6\u8ba4\u4e3a\u4e0d\u5e94\u8be5\u6709txnLock, \u4e5f\u4e0d\u6e05\u695a [\u9501\u51b2\u7a81\u68c0\u67e5]\u662f\u4ec0\u4e48\u3002\n\u672c\u6848\u5c31\u662f\u4e00\u4e2a\u9690\u5f0f\u4e50\u89c2\u4e8b\u52a1prewrite\u4e0a\u9501\u65f6\u9047\u5230\u5199\u5199\u51b2\u7a81,\n\u7136\u540e\u901a\u8fc7backoff, \u6700\u7ec8\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f, \u4f46\u82b1\u4e86\u597d\u51e0\u79d2\u949f\u3002\ntikv\u65e5\u5fd7key is locked,\nwill clean up\u4ec0\u4e48\u610f\u601d\n[key is locked]\u8bf4\u660e\u662f\u5199\u5199\u51b2\u7a81, \u56e0\u4e3a\u8bfb\u5199\u51b2\u7a81\u4e0d\u662f\u8fd9\u4e2a\u3002\nwill clean up\u662f\u8bf4\u8fd9\u4e2a\u9501\u53ef\u80fd\u8fc7\u4e00\u4f1a\u513f\u5c31\u4f1a\u88ab\u9501\u4e3b\u4eba\u6e05\u7406,\n\u8fd9\u53ea\u662f\u5047\u8bbe, \u5982\u679c\u9501\u4e3b\u4eba\u51fa\u4e86\u4ec0\u4e48\u610f\u5916, \u5c31\u4e0d\u4f1a\u9a6c\u4e0a\u89e3\u9501\u3002\n\u8bf4\u70b9\u9898\u5916\u8bdd\n\u60f3\u6539\u7684xx\u884c\u90fd\u88ab\u522b\u4eba\u5148\u6539\u4e86\n\u4e3a\u4ec0\u4e48\u8fd8\u8981\u91cd\u8bd5?\n\u4f1a\u4e0d\u4f1a\u628a\u522b\u4eba\u7684\u4fee\u6539\u62b9\u53bb?\n\u6587\u6863\u4e2d\u8bf4\u91cd\u8bd5\u4f1a\u5bfc\u81f4\u4e22\u5931\u66f4\u65b0\n\u662f\u4e1a\u52a1\u4e0a\u8ba9\u5927\u5bb6\u5904\u7406\u540c\u4e00\u884c\u624d\u6709\u51b2\u7a81, \u8bf4\u660e\u4e1a\u52a1\u5141\u8bb8\u91cd\u8bd5,\n\u6bd4\u5982\u4e1a\u52a1sql\u662f, update tab set x=x+1, xdate=now() where ...\u3002\n\u800c\u4e14, \u91cd\u8bd5\u662f\u91cd\u8dd1sql,\u5305\u62ecstart_ts,\u5047\u5982\u6709now(),\u662f\u53d6\u65b0\u503c\n\u5173\u4e8e\u91cd\u8bd5\u4e0e\u4e22\u5931\u66f4\u65b0"})})]})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},6113:(n,e,t)=>{t.d(e,{A:()=>r});var i=t(6540),o=t(4848);class r extends i.Component{componentDidMount(){$("#graph").graphviz({url:this.props.children,ready:function(){var n=this;n.nodes().click((function(){var e=$();e.push(this),e=(e=e.add(n.linkedFrom(this,!0))).add(n.linkedTo(this,!0)),n.highlight(e,!0),n.bringToFront(e)})),$(document).keydown((function(e){27==e.keyCode&&n.highlight()})),$("#graph")[0].addEventListener("click",(function(){n.highlight()}),!0)}})}render(){return(0,o.jsx)("div",{id:"graph",children:" "})}}},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>c});var i=t(6540);const o={},r=i.createContext(o);function s(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);